include/master-slave.inc
[connection master]
SET @@SESSION.gtid_domain_id=0;
CREATE TABLE t (a INT);
call mtr.add_suppression("connecting slave requested to start from.*which is not in the master's binlog");
include/stop_slave.inc
CHANGE MASTER TO master_use_gtid=slave_pos;
SET @@SESSION.gtid_domain_id=11;
SET @@SESSION.server_id=111;
SET @@SESSION.gtid_seq_no=1;
INSERT INTO t SET a=1;
SET @save.gtid_slave_pos=@@global.gtid_slave_pos;
SET @@global.gtid_slave_pos=concat(@@global.gtid_slave_pos,  ",", 11, "-", 111, "-", 1 + 1);
Warnings:
Warning	1947	Specified GTID 0-1-1 conflicts with the binary log which contains a more recent GTID 0-2-2. If MASTER_GTID_POS=CURRENT_POS is used, the binlog position will override the new value of @@gtid_slave_pos.
START SLAVE IO_THREAD;
include/wait_for_slave_io_error.inc [errno=1236]
FLUSH BINARY LOGS;
PURGE BINARY LOGS TO 'master-bin.000002';;
Gtid binlog state after purge to the latest file:  
show binary logs;
Log_name	File_size
master-bin.000002	#
show binlog events in 'master-bin.000002' limit 1,1;
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
master-bin.000002	#	Gtid_list	1	#	[11-111-1,0-1-1]
SELECT @@GLOBAL.gtid_binlog_state, @@GLOBAL.gtid_binlog_pos as 'Before Delete Domain';
@@GLOBAL.gtid_binlog_state	Before Delete Domain
0-1-1,11-111-1	0-1-1,11-111-1
FLUSH BINARY LOGS DELETE_DOMAIN_ID=(11);
SELECT @@GLOBAL.gtid_binlog_state, @@GLOBAL.gtid_binlog_pos as 'After Delete Domain';
@@GLOBAL.gtid_binlog_state	After Delete Domain
0-1-1	0-1-1
SELECT @@GLOBAL.gtid_slave_pos as 'Slave Gtid Pos';
Slave Gtid Pos
0-1-1,11-111-2
include/start_slave.inc
INSERT INTO t SET a=1;
include/wait_for_slave_io_error.inc [errno=1236]
FLUSH BINARY LOGS;
PURGE BINARY LOGS TO 'master-bin.000004';;
FLUSH BINARY LOGS DELETE_DOMAIN_ID=(11);
include/start_slave.inc
SET @@SESSION.gtid_domain_id=0;
DROP TABLE t;
include/rpl_end.inc
